<div class="post-container" onclick="drillInto(event)" th:data-_id="${item._id}"
     th:fragment="postContainer(item)" xmlns:th="http://www.thymeleaf.org">

  <!-- Header -->
  <div class="post-header">
    <b class="post-author" th:text="${item.username}"></b>
    <span class="post-date"
          th:text="${#dates.format(new java.util.Date(item.time * 1000L), 'dd.MM.yyyy HH:mm')}"></span>
  </div>

  <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;">
    <!-- Post text -->
    <div class="post-text" th:text="${item.text}"></div>

    <!-- Attachments -->
    <div th:if="${item.attachment != null and item.attachment != ''}">

      <div th:id="'attachment_' + ${item._id}" 
             th:data-raw="${item.attachment}" 
             class="attachment-area">
        </div>

        <script th:inline="javascript">
            (function() {
                var id = 'attachment_' + [[${item._id}]];
                var element = document.getElementById(id);
                if (!element) return;

                var raw = element.getAttribute("data-raw");
                if (!raw) return;

                var parts = raw.split(":::");
                var fileName = "download";
                var fileContent = raw;

                if (parts.length > 1) {
                    fileName = parts[0];
                    fileContent = parts[1];
                }

                if (fileContent.includes("data:image")) {
                    element.innerHTML = `<img src="${fileContent}" style="max-width: 50%; height: auto; border-radius: 8px; display: block;" />`;
                } else {
                    element.innerHTML = `
                        <a href="${fileContent}" download="${fileName}" onclick="event.stopPropagation()">
                          ${fileName}
                        </a>`;
                }
            })();
        </script>
    </div>
  </div>

  <div class="reactions">
    <!-- Like button -->
    <button class="button" onclick="likePost(event)"
            th:data-likes="${item.likes}" th:data-post_id="${item._id}">Like
    </button>
    <span
        th:text="${(item.likes == null || item.likes.trim().length() == 0) ? 0 : item.likes.trim().split(' +').length}"></span>

    <!-- Dislike button -->
    <button class="button" onclick="dislikePost(event)"
            th:data-dislikes="${item.dislikes}" th:data-post_id="${item._id}">Dislike
    </button>
    <span
        th:text="${(item.dislikes == null || item.dislikes.trim().length() == 0) ? 0 : item.dislikes.trim().split(' +').length}"></span>

    <!-- Delete button -->
    <button class="button" onclick="deletePost(event)"
            th:data-post_id="${item._id}">Delete
    </button>
  </div>
</div>
