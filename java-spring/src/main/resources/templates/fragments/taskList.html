<ul id="task_list" th:fragment="taskListFrag (tasks)">
    <h2>Posts</h2>
    <div th:each="item : ${tasks}">
        <!-- Root posts (no parent) -->
        <div th:if="${item.parent == null or item.parent == ''}"
             style="margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <div>
                <b th:text="${item.author_id}"></b>
                <span th:text="${#dates.format(new java.util.Date(item.time * 1000L), 'dd.MM.yyyy HH:mm')}"></span>
            </div>
            <div th:text="${item.text}"></div>

            <button th:attr="
                hx-get='/tasks/replyForm',
                hx-vals='{&quot;id&quot;:&quot;' + ${item.id} + '&quot;}',
                hx-target='#reply_form_' + ${item.id},
                hx-swap='innerHTML'"
                    style="background-color: #007bff; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; margin-top: 5px;">
                Reply
            </button>

            <div th:id="'reply_form_' + ${item.id}"></div>

            <!-- Replies to this post -->
            <div th:style="'margin-left: 30px; border-left: 3px solid #e0e0e0; padding-left: 15px;'">
                <div th:each="reply : ${tasks}" th:if="${reply.parent == item.id}">
                    <div style="margin: 10px 0; padding: 8px; background-color: #f8f9fa; border-radius: 3px;">
                        <div>
                            <b th:text="${reply.author_id}"></b>
                            <span th:text="${#dates.format(new java.util.Date(reply.time * 1000L), 'dd.MM.yyyy HH:mm')}"></span>
                        </div>
                        <div th:text="${reply.text}"></div>

                        <button th:attr="
                            hx-get='/tasks/replyForm',
                            hx-vals='{&quot;id&quot;:&quot;' + ${reply.id} + '&quot;}',
                            hx-target='#reply_form_' + ${reply.id},
                            hx-swap='innerHTML'"
                                style="background-color: #6c757d; color: white; padding: 3px 8px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; margin-top: 5px;">
                            Reply
                        </button>

                        <div th:id="'reply_form_' + ${reply.id}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ul>